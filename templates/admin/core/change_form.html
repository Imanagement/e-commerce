{% extends "admin/change_form.html" %}
{% load i18n admin_urls static admin_modify %}


{% block admin_change_form_document_ready %}
    <script type="text/javascript"
            id="django-admin-form-add-constants"
            src="{% static 'admin/js/change_form.js' %}"
            {% if adminform and add %}
                data-model-name="{{ opts.model_name }}"
            {% endif %}>
    </script>
<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
    <script>
    if(document.getElementsByTagName('body')[0].classList.contains('model-product')) {
            var category_input_option_value = document.getElementsByName('category')[0].getElementsByTagName('option')[0].value;
                category = $('#id_category')
                    $(document).ready(function(e){
                        category_input_option_value = category.val()   
                        $.ajax({
                            type: 'GET',
                            url: window.location.pathname,
                            data: {
                                'category': category_input_option_value,
                            },
                            error: function(xhr, status, error) {
                                console.log(status)
                            },
                            success: function(xhr, status) {
                                current_inputs = $('#propertyvalue_set-group').find('.form-row')
                                result_inputs = $(xhr).find('#propertyvalue_set-group').find('.form-row')
                                for(i=0; i < current_inputs.length; i++){
                                    $(current_inputs[i]).replaceWith($(result_inputs)[i])
                                }
                                console.log('success')
                                }
                        })
                    })
                    document.getElementById('id_category').onchange = function(e) {
                        category_input_option_value = this.value            
                        $.ajax({
                            type: 'GET',
                            url: window.location.pathname,
                            data: {
                                'category': category_input_option_value,
                            },
                            error: function(xhr, status, error) {
                                console.log(status)
                            },
                            success: function(xhr, status) {
                                current_inputs = $('#propertyvalue_set-group').find('.form-row')
                                result_inputs = $(xhr).find('#propertyvalue_set-group').find('.form-row')
                                for(i=0; i < current_inputs.length; i++){
                                    $(current_inputs[i]).replaceWith($(result_inputs)[i])
                                }
                                console.log('success')
                                }
                        })
                    }
        }
        

    </script>

{% endblock %}